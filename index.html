<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device and Network Information</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/1.0.2/ua-parser.min.js"></script>
</head>
<body>
    <h1>Device and Network Information</h1>
    <div>
        <h3>IP Address:</h3>
        <p id="ip"></p>
    </div>
    <div>
        <h3>Network Information:</h3>
        <p id="network"></p>
    </div>
    <div>
        <h3>Device Information:</h3>
        <p id="device"></p>
    </div>
    <div>
        <h3>Browser Information:</h3>
        <p id="browser"></p>
    </div>

    <script>
        async function fetchIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error fetching IP:', error);
                return 'Unknown';
            }
        }

        function fetchNetworkInfo() {
            if ('connection' in navigator) {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                return `
                    Effective Type: ${connection.effectiveType}, 
                    Downlink: ${connection.downlink} Mbps, 
                    RTT: ${connection.rtt} ms, 
                    Save Data: ${connection.saveData ? 'Enabled' : 'Disabled'}
                `;
            }
            return 'Network Information API not supported.';
        }

        function fetchDeviceInfo() {
            const parser = new UAParser();
            const result = parser.getResult();

            return {
                device: `
                    Device Type: ${result.device.type || 'Unknown'}, 
                    Device Model: ${result.device.model || 'Unknown'}, 
                    OS: ${result.os.name || 'Unknown'} ${result.os.version || ''}
                `,
                browser: `
                    Browser: ${result.browser.name || 'Unknown'} ${result.browser.version || ''}, 
                    Engine: ${result.engine.name || 'Unknown'}
                `
            };
        }

        async function collectAndDisplayData() {
            const ip = await fetchIPAddress();
            const network = fetchNetworkInfo();
            const { device, browser } = fetchDeviceInfo();

            // Display the data on the webpage
            document.getElementById('ip').innerText = ip;
            document.getElementById('network').innerText = network;
            document.getElementById('device').innerText = device;
            document.getElementById('browser').innerText = browser;
            
            // Optionally, you can still save the data to Google Sheet
            const data = { ip, network, device, browser };
            saveDataToGoogleSheet(data);
        }

        async function saveDataToGoogleSheet(data) {
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxZfAjcvsfY2Y8KeHrRZXXYUSGjspjlZQhPSbTXwpDJ1k7v4uXzRlhJglazkfxbSw9U/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    console.error('Failed to save data.');
                }
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        collectAndDisplayData();
    </script>
</body>
</html>